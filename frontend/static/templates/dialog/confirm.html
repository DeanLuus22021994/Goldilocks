{# Confirmation Dialog Component Usage: {% include 'dialog/confirm.html' with
{'id': 'deleteConfirm', 'title': 'Delete Item', 'message': 'Are you sure?',
'confirm_text': 'Delete', 'confirm_class': 'btn-danger'} %} #}

<div
  class="dialog-overlay"
  id="{{ id or 'confirmDialog' }}"
  style="display: none"
>
  <div class="dialog-container dialog-sm">
    <div class="dialog-content">
      <div class="dialog-header">
        <div class="dialog-icon dialog-icon-warning">{{ icon or '⚠️' }}</div>
        <h2 class="dialog-title">{{ title or 'Confirm Action' }}</h2>
        <button
          type="button"
          class="dialog-close"
          onclick="closeDialog('{{ id or 'confirmDialog' }}')"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="dialog-body">
        <p class="dialog-message">
          {{ message or 'Are you sure you want to proceed?' }}
        </p>
        {% if details %}
        <div class="dialog-details">{{ details|safe }}</div>
        {% endif %}
      </div>

      <div class="dialog-footer">
        <button
          type="button"
          class="btn btn-secondary"
          onclick="closeDialog('{{ id or 'confirmDialog' }}')"
        >
          {{ cancel_text or 'Cancel' }}
        </button>
        <button
          type="button"
          class="btn {{ confirm_class or 'btn-danger' }}"
          onclick="{{ confirm_action or 'confirmAction()' }}"
        >
          {{ confirm_text or 'Confirm' }}
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .dialog-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1050;
    backdrop-filter: blur(2px);
  }

  .dialog-container {
    max-width: 90vw;
    max-height: 90vh;
    width: 100%;
    display: flex;
    flex-direction: column;
  }

  .dialog-sm {
    max-width: 400px;
  }
  .dialog-md {
    max-width: 500px;
  }
  .dialog-lg {
    max-width: 700px;
  }

  .dialog-content {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
      0 10px 10px -5px rgba(0, 0, 0, 0.04);
    display: flex;
    flex-direction: column;
    max-height: 100%;
  }

  .dialog-header {
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
    padding: var(--space-4);
    border-bottom: 1px solid var(--border);
  }

  .dialog-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
    margin-top: var(--space-1);
  }

  .dialog-icon-warning {
    color: var(--warning, #f59e0b);
  }
  .dialog-icon-danger {
    color: var(--error, #dc3545);
  }
  .dialog-icon-info {
    color: var(--info, #3b82f6);
  }
  .dialog-icon-success {
    color: var(--success, #10b981);
  }

  .dialog-title {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
    flex: 1;
  }

  .dialog-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    line-height: 1;
    padding: 0;
    cursor: pointer;
    opacity: 0.7;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius);
    flex-shrink: 0;
  }

  .dialog-close:hover {
    opacity: 1;
    background: var(--bg-subtle);
  }

  .dialog-body {
    padding: var(--space-4);
    flex: 1;
    overflow-y: auto;
  }

  .dialog-message {
    margin: 0 0 var(--space-3);
    line-height: 1.6;
  }

  .dialog-details {
    padding: var(--space-3);
    background: var(--bg-subtle);
    border-radius: var(--radius);
    font-size: 0.875rem;
    color: var(--muted);
  }

  .dialog-footer {
    padding: var(--space-4);
    border-top: 1px solid var(--border);
    display: flex;
    gap: var(--space-2);
    justify-content: flex-end;
  }

  /* Animation */
  .dialog-overlay {
    animation: dialogFadeIn 0.15s ease-out;
  }

  .dialog-content {
    animation: dialogSlideIn 0.15s ease-out;
  }

  @keyframes dialogFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes dialogSlideIn {
    from {
      transform: scale(0.95) translateY(-10px);
      opacity: 0;
    }
    to {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
  }

  @media (max-width: 768px) {
    .dialog-container {
      max-width: 95vw;
    }

    .dialog-header {
      flex-direction: column;
      text-align: center;
      gap: var(--space-2);
    }

    .dialog-footer {
      flex-direction: column-reverse;
    }

    .dialog-footer .btn {
      justify-content: center;
    }
  }
</style>

<script>
  function openDialog(dialogId) {
    const dialog = document.getElementById(dialogId);
    if (dialog) {
      dialog.style.display = "flex";
      document.body.style.overflow = "hidden";

      // Focus the first button
      const firstButton = dialog.querySelector(".dialog-footer .btn");
      if (firstButton) {
        firstButton.focus();
      }
    }
  }

  function closeDialog(dialogId) {
    const dialog = document.getElementById(dialogId);
    if (dialog) {
      dialog.style.display = "none";
      document.body.style.overflow = "";
    }
  }

  // Close dialog when clicking overlay
  document.addEventListener("click", function (e) {
    if (e.target.classList.contains("dialog-overlay")) {
      closeDialog(e.target.id);
    }
  });

  // Close dialog with Escape key
  document.addEventListener("keydown", function (e) {
    if (e.key === "Escape") {
      const visibleDialogs = document.querySelectorAll(
        '.dialog-overlay[style*="flex"]'
      );
      visibleDialogs.forEach((dialog) => closeDialog(dialog.id));
    }
  });

  // Default confirm action (can be overridden)
  function confirmAction() {
    console.log("Confirm action triggered");
    closeDialog(event.target.closest(".dialog-overlay").id);
  }
</script>
