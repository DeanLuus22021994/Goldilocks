services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    image: goldilocks-flask:latest
    container_name: goldilocks-web
    init: true
    # Host networking + privileged root container
    network_mode: host
    privileged: true
    environment:
      - FLASK_APP=app.py
    volumes:
      - ./:/app
      - pip-cache:/root/.cache/pip
    command:
      [
        "gunicorn",
        "--bind",
        "0.0.0.0:9000",
        "--workers",
        "0",
        "--threads",
        "2",
        "--access-logfile",
        "-",
        "--error-logfile",
        "-",
        "app:app",
      ]
    restart: unless-stopped

volumes:
  pip-cache:
